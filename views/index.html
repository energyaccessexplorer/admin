<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">

    <script src="/config.js"></script>
    <script src="/lib/duck-tape/duck-tape-bundle.js"></script>

    <link rel="shortcut icon" type="image/png" href="/images/favicon.png"/>

    <title>Energy Access :: Admin</title>
  </head>

  <body>
    <nav>
      <a href="/"
         style="flex: 0;
                padding: 0.5em;
                padding-left: 1em;
                padding-right: 1em;"></a>
      <a href="/?model=geographies">Geographies</a>
      <a href="/?model=categories">Categories</a>
    </nav>

    <main></main>
  </body>

  <script>
    dt_fetchables = {
      "geographies": {
        primary: 'name',
        placeholder: "name",
        options: function(v) {
          return {
            table: 'geographies',
            query: `select=id,name&name=ilike.*${v}*`,
            input: x => x['id'],
            descriptor: x => x['name'],
            value: v,
            threshold: 2
          };
        }
      },

      "categories": {
        primary: 'id',
        placeholder: "name",
        options: function(v) {
          return {
            table: 'categories',
            query: `select=id,name,name_long,unit&name=ilike.*${v}*`,
            input: x => x['id'],
            descriptor: x => `${x.name} - ${x.name_long}`,
            value: v,
            threshold: 2
          }
        }
      },

      "datasets": {
        primary: 'id',
        placeholder: "category_name",
        options: function(v) {
          return {
            table: 'datasets',
            query: `select=id,geography_name,category_name,category_id&category_name=ilike.*${v}*`,
            input: x => x['id'],
            descriptor: x => `${x.geography_name} - ${x.category_name}`,
            value: v,
            threshold: 2
          }
        }
      },

      "files": {
        primary: 'id',
        placeholder: "label (optional)",
        options: function(v) {
          let em = location.get_query_param('edit_model');

          let dataset_param = '';
          let label_param = '';

          if (dt_model === 'datasets' && em.match(UUID_REGEXP))
            dataset_param = `dataset_id=eq.${em}`;

          if (v === '' || v === null) ;
          else label_param = `&label=ilike.*${v}*`

          return {
            table: 'files',
            query: `select=id,label,endpoint&${dataset_param}${label_param}`,
            input: x => x['id'],
            descriptor: x => `${x.label} - ${x.endpoint}`,
            value: v,
            threshold: 0
          };
        }
      }
    };
  </script>
</html>
