<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">

    <script src="/config.js"></script>
    <script src="/lib/duck-tape/duck-tape-bundle.js"></script>

    <link rel="shortcut icon" type="image/png" href="/images/favicon.png"/>

    <title>Energy Access :: Admin</title>
  </head>

  <body>
    <nav>
      <a href="/"
         style="flex: 0;
                padding: 0.5em;
                padding-left: 1em;
                padding-right: 1em;"></a>
      <a href="/?model=geographies">Geographies</a>
      <a href="/?model=categories">Categories</a>
    </nav>

    <main></main>
  </body>

  <script>
    dt_fetchables = {
      "geographies": {
        primary: 'name',
        placeholder: "name",
        options: function(v) {
          return {
            table: 'geographies',
            query: `select=id,name&name=ilike.*${v}*`,
            input: x => x['id'],
            descriptor: x => x['name'],
            value: v,
            threshold: 2
          };
        }
      },

      "categories": {
        primary: 'id',
        placeholder: "name",
        options: function(v) {
          return {
            table: 'categories',
            query: `select=id,name,name_long,unit&name=ilike.*${v}*`,
            input: x => x['id'],
            descriptor: x => `${x.name} - ${x.name_long}`,
            value: v,
            threshold: 2
          }
        }
      },

      "datasets": {
        primary: 'id',
        placeholder: "category_name",
        options: function(v) {
          return {
            table: 'datasets',
            query: `select=id,geography_name,category_name,category_id&category_name=ilike.*${v}*`,
            input: x => x['id'],
            descriptor: x => `${x.geography_name} - ${x.category_name}`,
            value: v,
            threshold: 2
          }
        }
      },

      "files": {
        primary: 'id',
        placeholder: "label (optional)",
        options: function(v) {
          let em = location.get_query_param('edit_model');

          let dataset_param = '';
          let label_param = '';

          if (dt_model === 'datasets' && em.match(UUID_REGEXP))
            dataset_param = `dataset_id=eq.${em}`;

          if (v === '' || v === null) ;
          else label_param = `&label=ilike.*${v}*`

          return {
            table: 'files',
            query: `select=id,label,endpoint&${dataset_param}${label_param}`,
            input: x => x['id'],
            descriptor: x => `${x.label} - ${x.endpoint}`,
            value: v,
            threshold: 0
          };
        }
      }
    };
  </script>

  <template class="style" module="categories">
    <style>
      table td:nth-of-type(2) {
        font-family: monospace;
      }

      table td:nth-of-type(3),
      table td:nth-of-type(4) {
        text-align: center;
      }

      details[name="color_stops"] .input-group {
        display: inline-block !important;
      }
    </style>
  </template>

  <template class="tableheader" module="categories">
    <tr>
      <th>Name</th>
      <th>ID</th>
      <th>Unit</th>
      <th>DS count</th>
    </tr>
  </template>

  <template class="tablerow" module="categories">
    <tr>
      <td><a icon="edit"></a><span bind="name_long"></span></td>
      <td bind="name"></td>
      <td bind="unit"></td>
      <td bind-size="datasets"></td>
    </tr>
  </template>

  <template class="style" module="datasets">
    <style>
      table td:nth-of-type(1) {
        font-family: monospace;
      }
    </style>
  </template>

  <template class="tableheader" module="datasets">
    <tr>
      <th>Category</th>
      <th>Files</th>
    </tr>
  </template>

  <template class="tablerow" module="datasets">
    <tr>
      <td><a icon="edit"></a><span bind="category_name"></span></td>

      <td><a bind-attr="href"
             bind-value="id"
             bind-format="/?model=files&dataset_id={0}">files</a></td>
    </tr>
  </template>

  <template class="style" module="files">
    <style>
      table td:nth-of-type(1),
      table td:nth-of-type(2) {
        font-family: monospace;
      }
    </style>
  </template>

  <template class="tableheader" module="files">
    <tr>
      <th>Label</th>
      <th>Endpoint</th>
    </tr>
  </template>

  <template class="tablerow" module="files">
    <tr>
      <td><a icon="edit"></a> <span bind="label"></span></td>
      <td><span bind="endpoint"></span></td>
    </tr>
  </template>

  <template class="style" module="geographies">
    <style>
      table td:nth-of-type(3),
      table td:nth-of-type(2) {
        text-align: center;
      }

      table td:nth-of-type(2) {
        font-family: monospace;
      }
    </style>
  </template>

  <template class="tableheader" module="geographies">
    <tr>
      <th>Name</th>
      <th>CCA3</th>
      <th>ADM</th>
      <th>Datasets</th>
    </tr>
  </template>

  <template class="tablerow" module="geographies">
    <tr>
      <td bind-attr="class"
          bind-value="online"
          bind-not="disabled"><a icon="edit"></a> <span bind="name"></span></td>

      <td bind="cca3"></td>

      <td bind="adm"></td>

      <td><a bind-attr="href"
             bind-value="id"
             bind-format="/?model=datasets&geography_id={0}">datasets</a></td>
    </tr>
  </template>
</html>
